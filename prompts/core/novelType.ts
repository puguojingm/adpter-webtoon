
import { NovelType } from '../../types';

// Knowledge Base Constants
/**
 * 类型策略映射
 * 合并规则：
 * - 玄幻 + 武侠 → 玄幻/武侠类型
 * - 言情 + 古言 → 言情/古言类型
 * - 悬疑 + 推理 → 悬疑/推理类型
 * - 科幻 + 末世 → 科幻/末世类型
 * - 都市 → 都市/现代类型
 * - 重生 → 重生类型
 */
// 玄幻/武侠类型策略
const FANTASY_WUXIA_STRATEGY = `### 玄幻/武侠类型
**特殊要点**：
- 境界体系要清晰可视化（用系统面板展示）
- 战力数值要明确
- 打脸节奏要密集（每2-3集）
- 金手指规则要简单易懂
**改编重点**：
\`\`\`
必保留：
✓ 境界突破场景
✓ 打脸羞辱场景
✓ 越级挑战场景
✓ 身份曝光场景
✓ 宝物争夺场景
必删除：
❌ 修炼过程详细描写
❌ 功法原理解释
❌ 环境风景描写
❌ 赶路过渡
必强化：
⚡ 数值展示（境界/战力可视化）
⚡ 力量对比（用特效展现）
⚡ 打脸反应（围观者震惊）
\`\`\`
**压缩策略**：
- 修炼过程：用【蒙太奇】10秒展示
- 战斗过程：保留关键招式，删除回合描写
- 突破过程：用特效+数值展示`;
// 都市/现代类型策略
const URBAN_STRATEGY = `### 都市/现代类型
**特殊要点**：
- 现代社会规则要合理
- 身份对比要现实化
- 打脸方式多样化（财富/地位/能力）
- 场景贴近生活
**改编重点**：
\`\`\`
必保留：
✓ 身份反差场景（豪门vs屌丝）
✓ 财富对比场景（贫富差距）
✓ 地位碾压场景（身份揭露）
✓ 真相大白场景（误会解除）
✓ 商战对决场景
必删除：
❌ 日常生活琐事
❌ 工作细节描写
❌ 心理独白
❌ 城市风景描写
必强化：
⚡ 对话冲突（语言交锋）
⚡ 身份反转（视觉冲击）
⚡ 打脸时刻（众人反应）
\`\`\`
**压缩策略**：
- 商战过程：只保留关键决策和结果
- 调查过程：用【蒙太奇】快速展示
- 日常过渡：完全删除`;
// 言情/古言类型策略
const ROMANCE_STRATEGY = `### 言情/古言类型
**特殊要点**：
- 误会要合理化
- 虐点要精准狠辣
- 宠溺要甜到极致
- 情感张力要强
**改编重点**：
\`\`\`
必保留：
✓ 误会产生场景
✓ 虐心痛苦场景
✓ 真相大白场景
✓ 甜宠片段
✓ 吃醋争风场景
必删除：
❌ 心理独白（过度的）
❌ 日常甜蜜（重复的）
❌ 环境描写
❌ 无关支线
必强化：
⚡ 情感冲突（对话/表情）
⚡ 误会解除（反转时刻）
⚡ 虐心时刻（泪点）
⚡ 反差对比（虐转甜）
\`\`\`
**压缩策略**：
- 心理活动：转为对话或动作
- 日常甜蜜：只保留最甜的片段
- 误会铺垫：快速进入，不拖沓`;
// 悬疑/推理类型策略
const SUSPENSE_MYSTERY_STRATEGY = `### 悬疑/推理类型
**特殊要点**：
- 线索要清晰
- 反转要合理且震撼
- 节奏要紧张
- 真相要出人意料
**改编重点**：
\`\`\`
必保留：
✓ 关键线索发现
✓ 反转时刻
✓ 真相揭露场景
✓ 紧张追逐场景
✓ 凶手曝光场景
必删除：
❌ 推理过程（过度详细的）
❌ 细节描写
❌ 日常调查琐事
必强化：
⚡ 悬念设置
⚡ 反转冲击
⚡ 紧张氛围
⚡ 时间压力
\`\`\`
**压缩策略**：
- 推理过程：只保留关键线索和结论
- 调查细节：用【蒙太奇】快速展示
- 铺垫时间：大幅压缩`;
// 科幻/末世类型策略
const SCIFI_DOOMSDAY_STRATEGY = `### 科幻/末世类型
**特殊要点**：
- 世界观要快速建立
- 危机要持续紧张
- 觉醒/升级要震撼
- 黑科技要简单易懂
**改编重点**：
\`\`\`
必保留：
✓ 危机爆发场景
✓ 异能觉醒场景
✓ 黑科技展示
✓ 基地争夺
✓ 丧尸/怪物对抗
必删除：
❌ 世界观详细铺垫
❌ 科学原理解释
❌ 环境描写
❌ 日常求生琐事
必强化：
⚡ 视觉特效（异能/科技）
⚡ 紧张节奏（危机持续）
⚡ 危机升级（不断加强）
\`\`\`
**压缩策略**：
- 世界观建立：用【文字】+对话快速说明
- 科技原理：不解释，直接展示效果
- 求生过程：只保留关键冲突`;
// 重生类型策略
const REBIRTH_STRATEGY = `### 重生类型
**特殊要点**：
- 前世今生对比要强烈
- 先知优势要爽快利用
- 复仇节奏要密集
- 布局感要强（步步为营）
- 前世遗憾要逐一弥补
**核心爽点**：
- 先知剧情（"我早就知道"）
- 改变命运（避开危险/夺取机缘）
- 打脸仇敌（前世欺负我的人）
- 提前布局（"等你入套"）
- 实力碾压（重生后快速崛起）
- 身份反转（废材→天才）
**改编重点**：
\`\`\`
必保留：
✓ 重生回归场景（第1集核心）
✓ 前世记忆闪回（关键节点）
✓ 先知优势利用（夺取机缘/避开危险）
✓ 打脸前世仇敌场景
✓ 布局复仇场景（步步为营）
✓ 提前预判场景（"我早知道"）
✓ 改变命运关键节点
✓ 前世今生对比场景
必删除：
❌ 前世详细回忆（过长的）
❌ 重生原理解释
❌ 过度的内心纠结
❌ 重复的先知展示
❌ 无关的前世支线
必强化：
⚡ 前世今生对比（用【闪回】+对比画面）
⚡ 先知优势（"这次我知道..."）
⚡ 布局感（"三步计划"）
⚡ 打脸时刻（"你前世欺负我..."）
⚡ 提前预判（"果然和我想的一样"）
⚡ 命运改变（"这次不一样了"）
\`\`\`
**重生题材特有处理**：
**1. 重生开场（第1集）**
\`\`\`
标准开场结构：
【起】前世死亡/绝望场景（15秒）
  → 【闪回】前世被背叛/被害经过（快速）
【承】猛然惊醒，发现重生（10秒）
  → 确认时间/地点/身份
【转】决心改变命运（15秒）
  → 【独白】"这次，我要让你们付出代价"
【钩】即将发生的第一个改变（10秒）
  → 【卡黑】
禁止：
❌ 慢节奏的前世回忆
❌ 详细解释重生原理
❌ 过长的情绪酝酿
正确做法：
✅ 瞬间进入前世死亡场景
✅ 快速确认重生事实
✅ 立即展示先知优势
\`\`\`
**2. 前世记忆的使用**
\`\`\`
原则：
- 不要大段回忆，用【闪回】碎片化展示
- 只在关键节点闪回（打脸/复仇/改变命运时）
- 前世画面用灰色/暗色调区分
使用时机：
✓ 遇到前世仇敌时 → 闪回被害场景（5秒）
✓ 夺取机缘时 → 闪回前世错失场景（3秒）
✓ 避开危机时 → 闪回前世中招场景（3秒）
✓ 打脸时 → 闪回前世被羞辱场景（5秒）
禁止：
❌ 单独一集全是前世回忆
❌ 重复闪回同一场景
❌ 闪回超过10秒
\`\`\`
**3. 先知优势的展示**
\`\`\`
展示方法：
【方法1】提前预判
△ 主角："三天后会发生XX"
△ 配角："你怎么知道？"
△ 主角冷笑："等着看吧"
【三天后】果然发生，众人震惊
【方法2】提前布局
△ 主角暗中做准备
△ 众人不理解
△ 危机来临，主角早有准备
△ 众人震惊："你早就知道？！"
【方法3】改变剧情
△ 【闪回】前世：主角错失机缘/被害
△ 【现在】主角提前抢夺/避开危险
△ 仇敌傻眼："怎么不一样了？！"
强化台词：
✓ "我早就知道了"
✓ "这次，结局会不一样"
✓ "你前世做的事，我都记得"
✓ "让你看看，改变命运的代价"
✓ "这次换我碾压你了"
\`\`\`
**4. 复仇节奏控制**
\`\`\`
复仇对象分层：
- 小喽啰（前期）：快速打脸，建立爽点
- 主要仇敌（中期）：步步为营，逐个击破
- 幕后黑手（后期）：终极复仇
复仇方式：
✓ 夺取他的机缘
✓ 揭穿他的阴谋
✓ 让他众叛亲离
✓ 碾压他的实力
✓ 让他跪地求饶
✓ 让他体验前世我的痛苦
节奏要求：
- 每5集至少打脸1个前世仇敌
- 每20集彻底击败1个主要仇敌
\`\`\`
**5. 改变命运的关键节点**
\`\`\`
标准处理：
【前世】（闪回5秒）
△ 灰色画面：前世主角的失败/痛苦
△ 【文字】"前世，我在这里失去了一切"
【今生】（现在30秒）  
△ 彩色画面：今生主角的布局/行动
△ 主角："这次，不会再犯同样的错误"
△ 结果：成功改变，获得机缘/避开危险
△ 【独白】"命运，从此改写"
关键节点：
✓ 第一次改变：避开前世第一个危机
✓ 第二次改变：夺取前世错失的重要机缘
✓ 第三次改变：救下前世死去的重要人物
✓ 终极改变：彻底改写前世悲剧
\`\`\`
**压缩策略**：
- 前世回忆：用【闪回】3-5秒快速展示，不单独成集
- 重生原理：不解释，用【文字】一句话说明"重生归来"即可
- 布局过程：只保留关键步骤，用【蒙太奇】展示准备
- 复仇铺垫：删除过长铺垫，直接进入打脸高潮
- 先知优势：不要重复展示，每种展示方式用1-2次即可
**重生题材禁忌**：
\`\`\`
❌ 前世回忆过多（超过总篇幅10%）
❌ 重生原理解释（浪费时间）
❌ 过度纠结前世（快速进入今生改变）
❌ 先知优势滥用（失去紧张感）
❌ 复仇拖沓（要快速打脸）
❌ 改变命运太容易（要有挑战）
✅ 前世闪回碎片化（每次3-5秒）
✅ 重生事实快速确认（第1集完成）
✅ 立即展示改变（第2-3集就要有第一个改变）
✅ 先知优势精准使用（关键时刻）
✅ 复仇节奏密集（每5集打脸）
✅ 保留挑战感（不是无敌，仍需努力）
\`\`\`
**重生题材爽点密度**：
\`\`\`
每集必有：
- 先知优势展示 或
- 打脸前世仇敌 或  
- 改变前世命运 或
- 布局复仇计划
每5集必有：
- 一次重要的命运改变
- 一个前世仇敌被打脸
每20集必有：
- 一个主要仇敌被击败
- 一个重大遗憾被弥补
- 一个关键机缘被夺取
\`\`\`
**重生题材台词模板**：
\`\`\`
经典台词：
✓ "前世，你害我至此。今生，该你偿还了"
✓ "我早就知道你的打算，可惜，这次我不会上当"
✓ "前世我输了，因为我不知道。这次，我知道一切"
✓ "你以为你赢了？不，游戏才刚刚开始"
✓ "前世你踩着我的尸体往上爬，今生该换换了"
✓ "谢谢你前世教会我，这个世界有多残酷"
✓ "这次，让你尝尝我前世的痛苦"
\`\`\`
**重生题材开场示例**：
\`\`\`
※ 前世，悬崖边
【特效】画面灰暗，血色天空
△ 主角被数人围攻，身负重伤
△ 前方，未婚妻和好兄弟并肩而立，眼神冷漠
△ 未婚妻："你以为你是谁？配不上我"
△ 好兄弟："对不起，是我告密的，你的功法我也要了"
△ 主角被一掌击飞，坠落万丈深渊
【独白】"如果能重来...我一定..."
---
※ 今生，卧室
△ 主角猛然惊醒，大口喘气
△ 环顾四周，熟悉的房间
△ 看向镜子，年轻的面容
【文字】三年前
△ 主角拳头紧握，眼神冰冷
【独白】我...重生了
△ 门外传来敲门声，未婚妻的声音："还在睡吗？"
△ 主角嘴角勾起一抹冷笑
【独白】这次，让你们付出代价
【卡黑】
\`\`\``;


export const GENRE_STRATEGIES: Record<NovelType, string> = {
  // 玄幻/武侠 - 共用策略
  [NovelType.FANTASY]: FANTASY_WUXIA_STRATEGY,
  [NovelType.WUXIA]: FANTASY_WUXIA_STRATEGY,
  
  // 都市/现代
  [NovelType.URBAN]: URBAN_STRATEGY,
  
  // 言情/古言 - 共用策略
  [NovelType.ROMANCE]: ROMANCE_STRATEGY,
  [NovelType.ANCIENT_ROMANCE]: ROMANCE_STRATEGY,
  
  // 悬疑/推理 - 共用策略
  [NovelType.SUSPENSE]: SUSPENSE_MYSTERY_STRATEGY,
  [NovelType.MYSTERY]: SUSPENSE_MYSTERY_STRATEGY,
  
  // 科幻/末世 - 共用策略
  [NovelType.SCI_FI]: SCIFI_DOOMSDAY_STRATEGY,
  [NovelType.DOOMSDAY]: SCIFI_DOOMSDAY_STRATEGY,
  
  // 重生
  [NovelType.REBIRTH]: REBIRTH_STRATEGY,
};

export const getGenreStrategy = (genre: NovelType): string => {
  return GENRE_STRATEGIES[genre] ?? '';
};

